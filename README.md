# YellowDiagnostician

Экспериментальная внешняя компонента для платформы 1С:Предприятие 8.x с некоторыми функциями для расширенной диагностики работы как самой платформы, так и ее работы с конкретным окружением.

## Примеры использования

Компонента в различных своих версиях используется в разнообразных проектах:

* **[Управляемые инструменты разработчика (Infostart)](https://infostart.ru/public/1254364/)** - потрясающие инструменты для разработчиков: Консоль запросов, СКД, кода, Редактор объекта, Поиск и замена ссылок, Поиск ссылок. Улучшенный конструктор тонкого клиента. Развитие проекта «Управляемая консоль отчетов».
* **[Диагностика контекста выполнения](https://infostart.ru/public/1269564/)** - обработка для получения информации о контексте выполнения кода на сервере и клиенте.

## Поддерживаемые системы

* Windows 32 и 64 бит

## Предупреждение

Внимание!!!
Компонента экспериментальная и создавалась для конкретных целей.
Использование на Вашей ответственности, совести.

## API

Компонента имеет список методов для получения дополнительной информации. Некоторую из них можно получить в каком-либо виде средствами платформы 1С.

Компонента может использоваться как на клиенте, так и на сервере.

### Список методов

<b>DomainName (ИмяДомена)</b> - получает имя домена, доступное в контексте приложения.

Возвращаемое значение:

- Строка. Имя домена.

<b>UserName (ИмяПользователя)</b> - получает имя пользователя, от имени которого запущено приложение.

Возвращаемое значение:

- Строка. Имя пользователя.

<b>HostName (ИмяКомпьютера)</b> - получает имя компьютера, на котором запущено приложение.

Возвращаемое значение:

- Строка. Имя компьютера.

<b>ProcessName (ИмяПроцесса)</b> - получает полное имя процесса (путь до исполняемого файла).

Возвращаемое значение:

- Строка. Полное имя к исполняемому файлу процесса.

<b>ProcessId (ИдентификаторПроцесса)</b> - получает числовой идентификатор текущего процесса.

Возвращаемое значение:

- Целое число. Числовой идентификатор процесса.

<b>ThreadId (ИдентификаторПотока)</b> - получает числовой идентификатор текущего потока.

Возвращаемое значение:

- Целое число. Числовой идентификатор потока.

<b>Sleep (Ожидать)</b> - ожидание потока указанное время.

Параметры:
* delay - Число (целое) - Количество секунд ожидания.

Возвращаемое значение:

- Отсутствует.

<b>CurrentDate (ТекущаяДата)</b> - текущая дата в контексте выполнения.

Возвращаемое значение:

- Дата и время. Текущая дата и время в контексте выполнения.

## Пример работы с компонентой

Ниже базовая информация по использованию внешней компоненты из кода встроенного языка 1С:Предприятия. Также пример внешней обработки Вы можете посмотреть в публикации **[Диагностика контекста выполнения (внешняя компонента)](https://infostart.ru/public/1269564/)**.

На первом этапе инициализируем компоненту из общего макета конфигурации "yy_YellowDiagnostician" (но Вы можете сохранить ее в любое другое подходящее место):

``` bsl
Функция СоздатьОбъектКомпоненты() Экспорт
	
	Попытка
		
		ИмяКомпоненты = "ОбщийМакет.yy_YellowDiagnostician";
		
		#Если Клиент Тогда
		УстановитьВнешнююКомпоненту(ИмяКомпоненты);
		#КонецЕсли
		
		Результат = ПодключитьВнешнююКомпоненту(ИмяКомпоненты, "YY", ТипВнешнейКомпоненты.Native);
		Если Результат = Ложь Тогда
			ВызватьИсключение "Не удалось создать объект компоненты """ + ИмяКомпоненты + """";
		КонецЕсли;
		
		ОбъектВК = Новый("AddIn.YY.YellowDiagnostician");
		Возврат ОбъектВК;
		
	Исключение
		
		ВызватьИсключение "Ошибка при инициализации компоненты: "
			+ Символы.ПС
			+ ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
		
	КонецПопытки;	
	
КонецФункции
```

Далее вызываем необходимые методы:

``` bsl
Компонента = СоздатьОбъектКомпоненты();

ИмяКомпьютера = Компонента.ИмяКомпьютера();
ИмяПользователя = Компонента.ИмяПользователя();
ИдентификаторПотока = Компонента.ИдентификаторПотока();
ИдентификаторПроцесса = Компонента.ИдентификаторПроцесса();
ИмяПроцесса = Компонента.ИмяПроцесса();
ИмяДомена = Компонента.ИмяДомена();
ТекущаяДатаКонтекста = Компонента.ТекущаяДата();

Компонента.Ожидать(10); // Ожидание 10 секунд
```

Пока что все :)

## Сборка проекта

Работа с проектом осуществляется через [CLion](https://www.jetbrains.com/ru-ru/clion/), но никто не мешает Вам использовать другую среду разработки.

1. Открыть проект [YY.YellowDiagnostician](https://github.com/YPermitin/YY.YellowDiagnostician).
2. Выполнить сборку с помощью CMake.
3. Profit! :)

## TODO

* Добавить версию для Linux
* Оптимизировать размер компоненты и совместимость с большим количеством окружений
* Расширить набор методов компоненты в части:
  * Дополнительная диагностика процессов и потоков
  * Создание потоков и их завершение
  * Информация по использованной памятью процессом
  * Проверка окружения

## Лицензия

Распостраняется под свободной лицензией [AGPL](https://ru.wikipedia.org/wiki/GNU_Affero_General_Public_License).
